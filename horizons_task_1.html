<!DOCTYPE html>
<html>
  <head>
    <title>Horizons Task</title>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-horizons-task.js"></script>
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body></body>
  <script>
    /* create timeline */
    var timeline = [];

    /* define welcome message trial */
    var welcome = {
    type: "html-keyboard-response",
    stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);

    /* define instructions trials */
    var instructions_1 = {
      type: "html-keyboard-response",
      stimulus: "<p>In this experiment, you will be able to choose between two " +
          " different slot machines (bandits) with different average payouts of points. </p>" +
          "Your goal is to earn the maximum number of points." +
          "<p>To choose the left bandit, press the <strong>left</strong> arrow key. To choose the right bandit, " +
          "press the <strong>right</strong> arrow key.</p>",
    };
    timeline.push(instructions_1);

    var instructions_2 = {
        type: "html-keyboard-response",
        stimulus: "<p>Games will be either 5 or 10 rounds. For the first <strong>four</strong> rounds of each game, " + 
          "you will be told to select either the right or left option. This will be indicated by a green square in the appropriate box. " + 
          "<p>If a green square appears in the left bandit, you must press the left arrow to reveal that payout and continue. " + 
          "If a green square appears in the right bandit, you must press the right arrow to reveal that payout and continue.</p>" + 
          "Starting with the <strong>fifth</strong> round, you will be able to make your own choices. This will be indicated by green square in both the left and right bandits. </p>" + 
          "<p>When you finish a game, you can press any key to continue to the next one.</p>" +
          "<p>Press any key to continue to the demonstration.</p>",
    };
    timeline.push(instructions_2);

    var demo_instructions = {
        type: "html-keyboard-response",
        stimulus: "For this demonstration, you will be asked to complete two games to ensure you understand the instructions." + 
            "<p>Press any key to proceed.</p>",
    }
    timeline.push(demo_instructions)

    var demo_game1 = {
        type: "horizons-task",
        horizon: 5,
        colors: ["lightblue", "orange"],
        means: [40, 70],
        forced_choices: ['leftarrow', 'rightarrow', 'rightarrow', 'leftarrow']
    }
    timeline.push(demo_game1)

    var demo_game2 = {
        type: "horizons-task",
        horizon: 10,
        colors: ["orange", "lightblue"],
        means: [60, 48],
        forced_choices: ['rightarrow', 'leftarrow', 'leftarrow', 'leftarrow']
    }
    timeline.push(demo_game2)

    var instructions_3 = {
        type: "html-keyboard-response",
        stimulus: "Great job! You are now ready to begin the experiment." + "<p>Press any key to continue to the task</p>",
    };
    timeline.push(instructions_3);

    var games = []

    function generate_games(){

        var forced_choices_two_two = [] // choices for a [2,2] game
        for (var i = 0; i < 3; i++) {
            forced_choices_two_two.push(['leftarrow', 'leftarrow', 'rightarrow', 'rightarrow']);
            forced_choices_two_two.push(['leftarrow', 'rightarrow', 'leftarrow', 'rightarrow']);
            forced_choices_two_two.push(['leftarrow', 'rightarrow', 'rightarrow', 'leftarrow']);
            forced_choices_two_two.push(['rightarrow', 'leftarrow', 'rightarrow', 'leftarrow']);
            forced_choices_two_two.push(['rightarrow', 'rightarrow', 'leftarrow', 'leftarrow']);
            forced_choices_two_two.push(['rightarrow', 'leftarrow', 'leftarrow', 'rightarrow']);
        }
        forced_choices_two_two.push(['leftarrow', 'rightarrow', 'leftarrow', 'rightarrow']);
        forced_choices_two_two.push(['rightarrow', 'leftarrow', 'leftarrow', 'rightarrow']);

        var forced_choices_three_one = [] // choices for a [3,1] and [1,3] game
        for (var i = 0; i < 2; i++) {
            forced_choices_three_one.push(['leftarrow', 'leftarrow', 'leftarrow', 'rightarrow']);
            forced_choices_three_one.push(['leftarrow', 'leftarrow', 'rightarrow', 'leftarrow']);
            forced_choices_three_one.push(['leftarrow', 'rightarrow', 'leftarrow', 'leftarrow']);
            forced_choices_three_one.push(['rightarrow', 'leftarrow', 'leftarrow', 'leftarrow']);
            forced_choices_three_one.push(['rightarrow', 'rightarrow', 'rightarrow', 'leftarrow']);
            forced_choices_three_one.push(['rightarrow', 'rightarrow', 'leftarrow', 'rightarrow']);
            forced_choices_three_one.push(['rightarrow', 'leftarrow', 'rightarrow', 'rightarrow']);
            forced_choices_three_one.push(['leftarrow', 'rightarrow', 'rightarrow', 'rightarrow']);
        }
        forced_choices_three_one.push(['leftarrow', 'leftarrow', 'rightarrow', 'leftarrow']);
        forced_choices_three_one.push(['rightarrow', 'leftarrow', 'leftarrow', 'leftarrow']);
        forced_choices_three_one.push(['rightarrow', 'rightarrow', 'leftarrow', 'rightarrow']);
        forced_choices_three_one.push(['leftarrow', 'rightarrow', 'rightarrow', 'rightarrow']);

        var colors = [];
        for (var i = 0; i < 10; i++) {
            colors.push(["orange", "lightblue"]);
            colors.push(["lightblue", "orange"]);
        }

        var means = [
            [40, 10], [40, 20], [40, 28], [40, 32], [40, 36],
            [40, 44], [40, 48], [40, 52], [40, 60], [40, 70],
            [60, 30], [60, 40], [60, 48], [60, 52], [60, 56],
            [60, 64], [60, 68], [60, 72], [60, 80], [60, 90]
        ]

        for (var i = 0; i < 20; i++) {
            game_h1_two_two = {
                type: "horizons-task",
                horizon: 5,
                colors: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(colors, 1)[0];
                },
                means: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(means, 1)[0];
                },
                forced_choices: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(forced_choices_two_two, 1)[0];
                }
            }

            game_h6_two_two = {
                type: "horizons-task",
                horizon: 10,
                colors: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(colors, 1)[0];
                },
                means: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(means, 1)[0];
                },
                forced_choices: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(forced_choices_two_two, 1)[0];
                }
            }

            game_h1_three_one = {
                type: "horizons-task",
                horizon: 5,
                colors: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(colors, 1)[0];
                },
                means: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(means, 1)[0];
                },
                forced_choices: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(forced_choices_three_one, 1)[0];
                }
            }

            game_h6_three_one = {
                type: "horizons-task",
                horizon: 10,
                colors: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(colors, 1)[0];
                },
                means: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(means, 1)[0];
                },
                forced_choices: function(){
                    return jsPsych.randomization.sampleWithoutReplacement(forced_choices_three_one, 1)[0];
                }
            }

            games.push(game_h1_two_two);
            games.push(game_h6_two_two);
            games.push(game_h1_three_one);
            games.push(game_h6_three_one);
        }
    }

    generate_games();
    games = jsPsych.randomization.shuffle(games);
    
    for (var i = 0; i < 80; i++){
        timeline.push(games[i])
    }

    /* start the experiment */
    jsPsych.init({
        timeline: timeline,
        show_progress_bar: true,
        on_finish: function() {
            jsPsych.data.displayData();
        }
    });

  </script>
</html>
